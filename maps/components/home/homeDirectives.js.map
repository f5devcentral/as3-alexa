{"version":3,"sources":["components/home/homeDirectives.js"],"names":["angular","module","directive","$window","console","log","restrict","scope","data","templateUrl","link","element","attrs","$watch","ticked","attr","d","source","x","y","target","circle","Math","max","min","width","height","txt","group","dragstarted","d3","event","active","simulation","alphaTarget","restart","fx","fy","dragged","dragended","rawSvg","find","svg","select","tip","offset","html","id","name","call","selectAll","transition","duration","style","remove","graph","nodes","links","root","fixed","forceSimulation","force","forceLink","distance","forceManyBody","strength","forceCenter","forceCollide","radius","append","enter","node","status","forcedOffline","on","show","hide","drag","text"],"mappings":"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","file":"../../../src/components/home/homeDirectives.js","sourcesContent":["/*\r\n * Copyright (c) 2018, F5 Networks, Inc. All rights reserved.\r\n * No part of this software may be reproduced or transmitted in any\r\n * form or by any means, electronic or mechanical, for any purpose,\r\n * without express written permission of F5 Networks, Inc.\r\n */\r\n(function () {\r\n\r\n  /* Home Directives */\r\n  angular.module('homeDirectives', []).\r\n    // Example Bubble Chart\r\n    directive('customGraph', function ($window) {\r\n      console.log('values from directive: ');\r\n      return {\r\n        restrict: 'EA',\r\n        scope: {data: '='},\r\n        templateUrl: 'partials/templates/graph.html',\r\n        link: function (scope, element, attrs) {\r\n\r\n          scope.$watch('data', function (data) {\r\n            if (data) {\r\n              // Look for responsive svg solution later!\r\n              // var width = window.innerWidth;\r\n              // var height = window.innerHeight;\r\n              const d3 = $window.d3;\r\n              const rawSvg = element.find('svg');\r\n              const svg = d3.select(rawSvg[0]);\r\n              const width = svg.attr('width');\r\n              const height = svg.attr('height');\r\n              const tip = d3.tip().\r\n                attr('class', 'd3-tip').\r\n                offset([-10, 0]).\r\n                html(function (d) {\r\n                  if (d.group === 20) {\r\n                    return `<span style='color:#fff'>${d.id}</span>`;\r\n                  } else if (d.group === 5) {\r\n                    return `<strong>PROXY:</strong> <span style='color:#fff'>${d.name}</span>`;\r\n                  } else if (d.group === 3) {\r\n                    return `<strong>SERVER:</strong> <span style='color:#fff'>${d.name}</span>`;\r\n                  }\r\n\r\n                });\r\n              svg.call(tip);\r\n\r\n              // .attr('viewBox','0 0 '+Math.min(width,height) +' '+Math.min(width,height) )\r\n              // .attr('preserveAspectRatio','xMinYMin')\r\n              // .append(\"g\")\r\n              // .attr(\"transform\", \"translate(\" + Math.min(width,height) / 2 + \",\" + Math.min(width,height) / 2 + \")\");\r\n\r\n              // Remove all elements before redrawing graph\r\n              svg.selectAll('circle').\r\n                transition().\r\n                duration(750).\r\n                style('opacity', 0).\r\n                remove();\r\n\r\n              svg.selectAll('line').\r\n                transition().\r\n                duration(750).\r\n                style('opacity', 0).\r\n                remove();\r\n\r\n              svg.selectAll('text').\r\n                transition().\r\n                duration(750).\r\n                style('opacity', 0).\r\n                remove();                \r\n\r\n              svg.\r\n                transition().\r\n                duration(750).\r\n                style('opacity', 1);\r\n\r\n              // Grid Layout ===============================================================\r\n\r\n\r\n              const graph = data;\r\n              const nodes = graph.nodes;\r\n              const links = graph.links;\r\n\r\n\r\n              // Root node\r\n              const root = graph.nodes[0];\r\n\r\n              root.x = width / 2;\r\n              root.y = height / 2;\r\n              root.fixed = true;\r\n\r\n\r\n              const simulation = d3.forceSimulation().\r\n                force('link', d3.forceLink().\r\n                  id(function (d) {\r\n                    return d.id;\r\n                  }).\r\n                  distance(function (d) {\r\n                    if (d.source.group === 20 && d.target.group === 5) {\r\n                      return 80;\r\n                    } else if (d.source.group === 5 || d.source.group === 3 && d.target.group === 3 || d.target.group === 5) {\r\n                      return 35;\r\n                    }\r\n                  })).\r\n\r\n                force('charge', d3.forceManyBody().strength(function (d) {\r\n                  if (d.group === 20) {\r\n                    return -60;\r\n                  } else if (d.group === 5) {\r\n                    return -40;\r\n                  }\r\n                  return -30;\r\n\r\n                })).\r\n                force('center', d3.forceCenter(width / 2, height / 2)).\r\n                force('collide', d3.forceCollide().radius(function (d) {\r\n                  if (d.group === 20) { // Big IP\r\n                    return 30;\r\n                  } else if (d.group === 3) { // Nodes\r\n                    return 8;\r\n                  } else if (d.group === 5) { // Proxies \r\n                    if (d.nodes) {\r\n                      return d.nodes * 0.5 + 15;\r\n                    }\r\n                    return 15;\r\n\r\n                  }\r\n                  return 8;\r\n\r\n\r\n                }));\r\n\r\n\r\n              const link = svg.append('g').\r\n                attr('class', 'links').\r\n                selectAll('line').\r\n                data(links).\r\n                enter().append('line').\r\n                attr('stroke-width', function (d) {\r\n                  return 2;\r\n                });\r\n\r\n              const node = svg.append('g').\r\n                attr('class', 'node');\r\n\r\n\r\n              const circle = node.selectAll('circle').\r\n                data(nodes).\r\n                enter().append('circle').\r\n                attr('r', function (d) {\r\n                  if (d.group === 20) { // Big IP\r\n                    return 18;\r\n                  } else if (d.group === 3) { // Nodes\r\n                    return 6;\r\n                  } else if (d.group === 5) { // Proxies \r\n                    return 11;\r\n                  }\r\n                  return 6;\r\n\r\n                }).\r\n                attr('fill', function (d) {\r\n                  // Change color of node balls according to status \r\n                  // Some proxy has \"authorize\" as status although status should only be authorized\r\n                  // Big-IP has distinct color\r\n                  if (d.group === 20) {\r\n                    return '#fff'; // BIG IP Ball\r\n                  } else if (d.group === 5) {\r\n                    if (d.status === 'preauthorized_proxy_not_ready') {\r\n                      return '#e21c1c';\r\n                    } else if (d.status === 'not_authorized_proxy_not_ready') {\r\n                      return '#c7c6c6';\r\n                    } else if (d.status === 'not_authorized_proxy_ready') {\r\n                      return '#ffaa33';\r\n                    } else if (d.status === 'authorized' || d.status === 'authorize') {\r\n                      return '#3d9e3d';\r\n                    }\r\n\r\n                  } else if (d.group === 3) {\r\n                    if (d.forcedOffline) {\r\n                      return '#232222';\r\n                    } else if (d.status === 'offline' || d.status === ' ' || d.status === '') {\r\n                      return '#e21c1c';\r\n                    } else if (d.status === 'online') {\r\n                      return '#3d9e3d';\r\n                    }\r\n                  }\r\n                }).\r\n                attr('class', function (d) {\r\n                  if (d.id === 'BIG IP') {\r\n                    return 'fixed-node';\r\n                  }\r\n                }).\r\n                on('mouseover', tip.show).\r\n                on('mouseout', tip.hide).\r\n                call(d3.drag().\r\n                  on('start', dragstarted).\r\n                  on('drag', dragged).\r\n                  on('end', dragended));\r\n\r\n              const txt = node.selectAll('text').\r\n                data(graph.nodes).\r\n                enter().append('text').\r\n                text(function (d) {\r\n                  if (d.group === 20) {\r\n                    return d.id;\r\n                  }\r\n\r\n                });\r\n\r\n\r\n              simulation.\r\n                nodes(graph.nodes).\r\n                on('tick', ticked);\r\n\r\n\r\n              simulation.force('link').\r\n                links(graph.links);\r\n\r\n              function ticked () {\r\n                link.\r\n                  attr('x1', function (d) {\r\n                    return d.source.x;\r\n                  }).\r\n                  attr('y1', function (d) {\r\n                    return d.source.y;\r\n                  }).\r\n                  attr('x2', function (d) {\r\n                    return d.target.x;\r\n                  }).\r\n                  attr('y2', function (d) {\r\n                    return d.target.y;\r\n                  });\r\n\r\n                circle.\r\n                  attr('cx', function (d) {\r\n                    return d.x = Math.max(10, Math.min(width - 10, d.x));\r\n                  }).\r\n                  attr('cy', function (d) {\r\n                    return d.y = Math.max(10, Math.min(height - 10, d.y));\r\n                  });\r\n\r\n                txt.\r\n                  attr('x', function (d) {\r\n                    // Adding x and y only for BIG IP for now\r\n                    if (d.group === 20) {\r\n                      return d.x - 16;\r\n                    }\r\n                  }).\r\n                  attr('y', function (d) {\r\n                    if (d.group === 20) {\r\n                      return d.y + 3;\r\n                    }\r\n\r\n                  });\r\n\r\n              }\r\n\r\n              function dragstarted (d) {\r\n                if (!d3.event.active) {\r\n                  simulation.alphaTarget(0.3).restart();\r\n                }\r\n                d.fx = d.x;\r\n                d.fy = d.y;\r\n              }\r\n\r\n              function dragged (d) {\r\n                d.fx = d3.event.x;\r\n                d.fy = d3.event.y;\r\n              }\r\n\r\n              function dragended (d) {\r\n                if (!d3.event.active) {\r\n                  simulation.alphaTarget(0);\r\n                }\r\n                d.fx = null;\r\n                d.fy = null;\r\n              }\r\n            }\r\n          });\r\n\r\n\r\n        }\r\n      };\r\n    });\r\n}());"]}